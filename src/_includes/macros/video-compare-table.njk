{# _includes/macros/video-compare-table.njk #}
{% macro videoCompareTable(items, specs) %}
  {% set videoSpecKeys = [
    "cpu_cores",
    "performance_cores",
    "efficiency_cores",
    "gpu_cores",
    "memory_bandwidth_gb_s",
    "video_decode",
    "video_encode",
    "prores_engines",
    "av1_decode"
  ] %}
  <table class="compare-table">
    <thead>
      <tr>
        <th>Spec</th>
        {% for item in items %}
          <th>{{ item.name }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {# Flatten all fields from all groups into a single list for easier lookup #}
      {% set all_fields = [] %}
      {% for group in specs.groups %}
        {% set all_fields = all_fields.concat(group.fields | default([])) %}
      {% endfor %}

      {% for key in videoSpecKeys %}
        <tr>
          <td>
            {# Find the field from our flattened list to get its label #}
            {% set field = all_fields | selectattr("key", "equalto", key) | first %}
            {{ field.label if field else key }}
          </td>
          {% for item in items %}
            <td>
              {% set value = item.specs[key] %}
              {% if value is not defined %}
                –
              {% elif value == true %}
                ✓
              {% elif value == false %}
                ✗
              {% elif value is iterable and value is not string %}
                {{ value | join(", ") }}
              {% else %}
                {{ value }}
              {% endif %}
            </td>
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endmacro %}
